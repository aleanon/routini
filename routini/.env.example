# Routini Environment Variables Configuration
# Copy this file to .env and adjust values as needed

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level filter
# Examples:
#   - "info" - all modules at INFO level
#   - "debug" - all modules at DEBUG level
#   - "routini=debug,pingora=info" - routini at DEBUG, pingora at INFO
#   - "routini::proxy=trace,pingora::lb=debug" - fine-grained control
RUST_LOG=info,routini=debug,pingora=info

# Directory for log files (leave empty for stdout only)
# Example: /var/log/routini
# When set, logs will be written to files with daily rotation
# Files will be named: routini.log, routini.log.2025-01-15, etc.
LOG_DIR=

# Enable JSON formatted logs (1=enabled, 0=disabled)
# Use JSON format for log aggregation systems (ELK, Loki, Splunk, etc.)
# Default: 0 (plain text format)
LOG_JSON=0

# Disable ANSI colors in logs (1=disabled, 0=enabled)
# Set to 1 in production/containers where colors aren't useful
# Default: not set (colors enabled)
# NO_COLOR=1

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================

# Main proxy server address
# Default: 127.0.0.1:3500
# SERVER_ADDRESS=127.0.0.1:3500

# Strategy endpoint address (for dynamic strategy changes)
# Default: 0.0.0.0:5000
# STRATEGY_ENDPOINT_ADDRESS=0.0.0.0:5000

# Prometheus metrics endpoint address
# Default: 0.0.0.0:9090
# PROMETHEUS_ADDRESS=0.0.0.0:9090

# =============================================================================
# LOAD BALANCER CONFIGURATION
# =============================================================================

# Default load balancing strategy
# Options: RoundRobin, Random, FNVHash, Consistent, FewestConnections, FastestServer
# DEFAULT_STRATEGY=RoundRobin

# Maximum iterations for backend selection
# Default: 256
# MAX_ITERATIONS=256

# Health check frequency (in seconds)
# Default: 1
# HEALTH_CHECK_FREQUENCY=1

# Run health checks in parallel (true/false)
# Default: false
# PARALLEL_HEALTH_CHECK=false

# =============================================================================
# ADAPTIVE LOAD BALANCER CONFIGURATION
# =============================================================================

# Strategy evaluation frequency (in seconds)
# How often to check if strategy should change
# Default: 5
# EVALUATE_STRATEGY_FREQUENCY=5

# Minimum number of connections before evaluating strategy changes
# Default: 1000
# MIN_NR_OF_CONNECTIONS=1000

# Connection divergence ratio threshold
# Ratio at which to consider switching from connection-based strategies
# Default: 1.2
# CONNECTIONS_DIV_RATIO=1.2

# Latency divergence ratio threshold
# Ratio at which to consider switching from latency-based strategies
# Default: 2.0
# LATENCY_DIV_RATIO=2.0

# Smoothing factor for exponential weighted moving average (EWMA)
# Used for latency calculations (0.0 - 1.0)
# Default: 0.5
# SMOOTHING_FACTOR=0.5

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Upstream keepalive pool size
# Number of persistent connections to maintain
# Default: 100000
# UPSTREAM_KEEPALIVE_POOL_SIZE=100000

# Number of worker threads
# Default: number of CPU cores
# WORKER_THREADS=

# =============================================================================
# DEVELOPMENT / DEBUGGING
# =============================================================================

# Enable color-eyre for better error messages (always enabled)
# RUST_BACKTRACE=1

# Enable profiling
# CARGO_PROFILE=profiling

# =============================================================================
# EXAMPLES - Different Environment Configurations
# =============================================================================

# --- Development (verbose logging, stdout only) ---
# RUST_LOG=debug
# LOG_DIR=
# LOG_JSON=0

# --- Production (moderate logging, files, JSON format) ---
# RUST_LOG=info,routini=debug,pingora=info
# LOG_DIR=/var/log/routini
# LOG_JSON=1
# NO_COLOR=1

# --- Debug Specific Module (routing issues) ---
# RUST_LOG=info,routini::proxy=trace
# LOG_DIR=/var/log/routini

# --- Debug Load Balancing ---
# RUST_LOG=info,routini::load_balancing=debug,routini::adaptive_loadbalancer=debug
# LOG_DIR=/var/log/routini

# --- Maximum Verbosity (very noisy!) ---
# RUST_LOG=trace
# LOG_DIR=/var/log/routini
